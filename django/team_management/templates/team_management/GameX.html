{% extends "team_management/index.html" %}

{% block css %}
	{% load static %}
    <link rel="stylesheet" href="{% static 'team_management/gameX.css' %}">
{% endblock %}


{% block body %}
	<h1>{{ game_id }}</h1>
	
	<p>
		Choose Team: <select id="teamSelector">
			<option value="0"></option>
			{% for team in team_list %}
				<option value="{{ team.id }}">{{ team.team_name }}</option> <!-- Change this to pick from only the teams in this game_id -->
			{% endfor %}
		</select>
	</p>
	
	<div class="dragon_counters">
		{% for dragonCounter in dragon_ball_list %}
			<span class="{{ dragonCounter.name }}" style="position:relative">
				<button class="down" style="border-top: 1em solid {{ dragonCounter.extra_data }}" onclick="counter({{ dragonCounter.id }}, -1)" ></button>
				<button class="up" style="border-bottom: 1em solid {{ dragonCounter.extra_data }}" onclick="counter({{ dragonCounter.id }}, 1)" ></button>
				<input type="number" min="0" step="1" value="0" id="{{ dragonCounter.id }}">
			</span>
		{% endfor %}
	</div>
	

	
	<div class="StandardButtons">
	{% for scoringType in standard_buttons_list %}
		<button class="{{ scoringType.input_group }}" id="{{ scoringType.id }}" value="0" onclick="Standard({{ scoringType.id }}, '{{ scoringType.name }}', {{ scoringType.limit }})">{{ scoringType.name }} 0{% if scoringType.limit != 0 %}/{{ scoringType.limit }}{% endif %}</button>
	{% endfor %}
	</div>
	<div id="testText">
	</div>
	<div id="deleteButtons">
	</div>
{% endblock %}



<script> <!--This tag and its endtag are there strictly for text highlighting in your text editor--> They are not in a block and don't appear in the html render as shown by this text
{% block script %}
function Standard(id,name,limit){
	checkTeam()
	button = document.getElementById(id);
	if(limit == 0 || button.value < limit){
		button.value = parseInt(button.value) + 1;
		sendAction(id, parseInt(button.value));
	}
	drawButton(button,name,limit);
}

function drawButton(button,name,limit){
	button.innerHTML = name + " " + button.value;
	if(limit != 0) {
		button.innerHTML += "/" + limit;
	}
}


var chatSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/game/');

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        //var message = data['message'];
		document.getElementById("testText").innerHTML += 'success!';
		document.getElementById("deleteButtons").innerHTML += "<button>Delete</button> " + data['liveScore_id'] + " | " + 
																data['time'] + " | " + data['scoringType_name'] +
																" | " + data['team_name'];
    };

function sendAction(id, value){
	team_id = document.getElementById('teamSelector').value
	chatSocket.send(JSON.stringify({
        'scoringType_id':id, 
		'team_id':team_id,
		'value':value,
    }));
}

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };
function counter(id, direction) {
	checkTeam();
	inputElem = document.getElementById(id);
	if (direction == 1) {
		inputElem.value = parseInt(inputElem.value) + 1;
	} else {
		if (inputElem.value > 0){
			inputElem.value = parseInt(inputElem.value) - 1;
		}
	}
	sendAction(id, parseInt(inputElem.value));
}

function checkTeam(){
	if(document.getElementById('teamSelector').value == '0'){
		alert("Please choose a team");
		throw new Error("Choose a team before sending data")
	}
}

{% endblock %}
</script>